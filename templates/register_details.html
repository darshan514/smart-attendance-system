{% extends "base.html" %}

{% block title %}Leo - Complete Your Registration{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="text-center mb-4">
            <div class="step-indicator">
                <div class="step completed" style="background: #48bb78; color: white;"><i class="bi bi-check"></i></div>
                <div class="step-line"></div>
                <div class="step completed" style="background: #48bb78; color: white;"><i class="bi bi-check"></i></div>
                <div class="step-line"></div>
                <div class="step active" style="background: #4a5568; color: white;"><span>3</span></div>
            </div>
            <h2 style="color: #2d3748; font-size: 24px; font-weight: 700; margin: 20px 0 8px 0;">Complete Your Profile</h2>
            <p style="color: #718096; font-size: 14px; margin: 0;">Just a few more details to finish</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'info' }}" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="POST">
            <!-- Full Name -->
            <div style="margin-bottom: 20px;">
                <label style="color: #2d3748; font-weight: 600; font-size: 13px; display: block; margin-bottom: 10px;"><i class="bi bi-person-fill"></i> Full Name</label>
                <input 
                    type="text" 
                    id="full_name" 
                    name="full_name" 
                    placeholder="Enter your full name"
                    required
                    style="width: 100%; border: 2px solid #e2e8f0; padding: 11px; border-radius: 8px; font-size: 15px; color: #2d3748;"
                >
            </div>

            <!-- Role Selection -->
            <div style="margin-bottom: 20px;">
                <label style="color: #2d3748; font-weight: 600; font-size: 13px; display: block; margin-bottom: 15px;"><i class="bi bi-briefcase-fill"></i> Select Your Role</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="role-card" onclick="selectRole('teacher')" style="border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #f8f9fa;">
                        <input type="radio" name="role" value="teacher" id="role-teacher" style="display: none;">
                        <div style="font-size: 32px; margin-bottom: 10px; color: #4a5568;"><i class="bi bi-person-badge"></i></div>
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 5px;">Teacher</div>
                        <div style="font-size: 12px; color: #718096;">Manage students &amp; attendance</div>
                    </div>
                    <div class="role-card" onclick="selectRole('student')" style="border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #f8f9fa;">
                        <input type="radio" name="role" value="student" id="role-student" checked style="display: none;">
                        <div style="font-size: 32px; margin-bottom: 10px; color: #4a5568;"><i class="bi bi-mortarboard"></i></div>
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 5px;">Student</div>
                        <div style="font-size: 12px; color: #718096;">View your attendance</div>
                    </div>
                </div>
            </div>

            <!-- Password -->
            <div style="margin-bottom: 20px;">
                <label style="color: #2d3748; font-weight: 600; font-size: 13px; display: block; margin-bottom: 10px;"><i class="bi bi-lock-fill"></i> Password</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    placeholder="Min. 6 characters"
                    minlength="6"
                    required
                    style="width: 100%; border: 2px solid #e2e8f0; padding: 11px; border-radius: 8px; font-size: 15px; color: #2d3748;"
                >
                <small style="color: #718096; display: block; margin-top: 10px; font-size: 12px;">
                    <i class="bi bi-info-circle"></i> Use a strong password with letters and numbers
                </small>
            </div>

            <!-- Confirm Password -->
            <div style="margin-bottom: 20px;">
                <label style="color: #2d3748; font-weight: 600; font-size: 13px; display: block; margin-bottom: 10px;"><i class="bi bi-lock-check"></i> Confirm Password</label>
                <input 
                    type="password" 
                    id="confirm_password" 
                    name="confirm_password" 
                    placeholder="Re-enter your password"
                    required
                    style="width: 100%; border: 2px solid #e2e8f0; padding: 11px; border-radius: 8px; font-size: 15px; color: #2d3748;"
                >
            </div>

            <!-- Password Strength Indicator -->
            <div class="password-strength" style="display: none; margin-bottom: 20px;">
                <small style="color: #718096;">Password strength:</small>
                <div style="height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden; margin-top: 5px;">
                    <div class="strength-meter-fill" id="strength-meter" style="height: 100%; width: 0; transition: all 0.3s ease; background: linear-gradient(90deg, #f5576c 0%, #f5576c 100%);"></div>
                </div>
            </div>

            <!-- Terms & Conditions -->
            <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <input 
                    type="checkbox" 
                    id="agree-terms" 
                    required
                    style="cursor: pointer;"
                >
                <label style="color: #2d3748; font-size: 13px; margin: 0; cursor: pointer;">
                    I agree to the <a href="#" style="color: #4a5568; text-decoration: none; font-weight: 600;">Terms &amp; Conditions</a>
                </label>
            </div>

            <button type="submit" style="width: 100%; background: #4a5568; color: white; border: none; font-weight: 600; padding: 11px; border-radius: 8px; font-size: 14px; cursor: pointer; transition: all 0.2s;">
                <i class="bi bi-check-circle"></i> Complete Registration
            </button>

            <div style="text-align: center; margin-top: 20px;">
                <p style="color: #718096; font-size: 13px; margin: 0;">
                    Already have an account? <a href="{{ url_for('login') }}" style="color: #4a5568; text-decoration: none; font-weight: 600;">Login here</a>
                </p>
            </div>
        </form>
    </div>
</div>

<style>
.auth-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #f5f6f8 0%, #e8eaef 100%);
    padding: 20px;
}

.auth-card {
    background: white;
    border-radius: 12px;
    padding: 45px;
    box-shadow: 0 5px 30px rgba(0, 0, 0, 0.08);
    max-width: 520px;
    width: 100%;
}

.step-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 20px;
}

.step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e2e8f0;
    color: #a0aec0;
    font-weight: 600;
    font-size: 14px;
}

.step.active {
    background: #4a5568;
    color: white;
}

.step.completed {
    background: #48bb78;
    color: white;
}

.step-line {
    width: 20px;
    height: 2px;
    background: #e2e8f0;
}

.alert {
    border-radius: 8px;
    border: none;
    margin-bottom: 20px;
    padding: 12px 16px;
    font-size: 13px;
}

.alert-danger {
    background: #fed7d7;
    color: #c53030;
}

.alert-success {
    background: #c6f6d5;
    color: #22543d;
}

.alert-info {
    background: #bee3f8;
    color: #2c5282;
}

input[type="text"]:focus,
input[type="password"]:focus {
    border-color: #4a5568 !important;
    box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.1) !important;
    outline: none;
}

input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: #4a5568;
}

.role-card:hover {
    border-color: #4a5568 !important;
    background: #f5f6f8 !important;
    transform: translateY(-2px);
}

.role-card.selected {
    border-color: #4a5568 !important;
    background: #f5f6f8 !important;
    box-shadow: 0 5px 15px rgba(74, 85, 104, 0.1) !important;
}

@media (max-width: 576px) {
    .auth-card {
        padding: 30px;
    }
    
    [style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
    }
}
</style>

<script>
function selectRole(role) {
    document.querySelectorAll('.role-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    if (role === 'teacher') {
        document.getElementById('role-teacher').checked = true;
        document.querySelectorAll('.role-card')[0].classList.add('selected');
    } else {
        document.getElementById('role-student').checked = true;
        document.querySelectorAll('.role-card')[1].classList.add('selected');
    }
}

document.getElementById('role-student').checked = true;
document.querySelectorAll('.role-card')[1].classList.add('selected');

document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    const strengthMeter = document.getElementById('strength-meter');
    const passwordStrength = document.querySelector('.password-strength');
    
    if (password.length > 0) {
        passwordStrength.style.display = 'block';
        
        let strength = 0;
        if (password.length >= 6) strength += 25;
        if (password.length >= 10) strength += 25;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 25;
        if (/[0-9]/.test(password) && /[!@#$%^&*]/.test(password)) strength += 25;
        
        strengthMeter.style.width = strength + '%';
        
        if (strength <= 25) strengthMeter.style.background = 'linear-gradient(90deg, #f5576c 0%, #f5576c 100%)';
        else if (strength <= 50) strengthMeter.style.background = 'linear-gradient(90deg, #ffa502 0%, #ffa502 100%)';
        else if (strength <= 75) strengthMeter.style.background = 'linear-gradient(90deg, #ffeb3b 0%, #ffeb3b 100%)';
        else strengthMeter.style.background = 'linear-gradient(90deg, #48bb78 0%, #48bb78 100%)';
    } else {
        passwordStrength.style.display = 'none';
    }
});

document.getElementById('confirm_password').addEventListener('change', function() {
    const password = document.getElementById('password').value;
    if (this.value !== password) {
        this.style.borderColor = '#c53030';
    } else {
        this.style.borderColor = '#e2e8f0';
    }
});

document.querySelectorAll('[role="alert"]').forEach(alert => {
    setTimeout(() => {
        try {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        } catch (e) {}
    }, 5000);
});
</script>
{% endblock %}
